<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Hướng dẫn viết App cho Onshop</title>
    <link rel="stylesheet" href="src/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="src/bootstrap/css/bootstrap-grid.min.css">
    <link rel="stylesheet" href="src/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body>
  <div class="wrapper d-flex align-items-stretch">
    <nav id="sidebar">
      <div class="custom-menu">
        <button type="button" id="sidebarCollapse" class="btn btn-primary">
          <i class="fa fa-bars"></i>
          <span class="sr-only">Toggle Menu</span>
        </button>
      </div>
      <div class="p-4 pt-5">
        <h1><a href="index.html" class="logo">Appstore</a></h1>
        <ul class="list-unstyled components mb-5">
          <li class="active">
            <a href="#introduce3">Giới thiệu</a>
          </li>
          <li>
            <a href="#">About</a>
          </li>
          <li>
            <a href="#pageSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Pages</a>
            <ul class="collapse list-unstyled" id="pageSubmenu">
              <li>
                <a href="#">Page 1</a>
              </li>
              <li>
                <a href="#">Page 2</a>
              </li>
              <li>
                <a href="#">Page 3</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="#">Portfolio</a>
          </li>
          <li>
            <a href="#">Contact</a>
          </li>
        </ul>

        <div class="mb-5">
          <h3 class="h6">Subscribe for newsletter</h3>
          <form action="#" class="colorlib-subscribe-form">
            <div class="form-group d-flex">
              <div class="icon"><span class="icon-paper-plane"></span></div>
              <input type="text" class="form-control" placeholder="Enter Email Address">
            </div>
          </form>
        </div>

        <div class="footer">
          <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib.com</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
        </div>

      </div>
    </nav>

    <!-- Page Content  -->
    <div id="content" class="p-4 p-md-5 pt-5">
      <section id="introduce">
        <div class="section-title">
          <h2 class="mb-4">Giới thiệu</h2>
        </div>
        <div class="section-content">
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        </div>
      </section>
      <section id="structure">
        <div class="section-title">
          <h2 class="mb-4">Cấu trúc & mô hình</h2>
        </div>
        <div class="section-content">
          <p>Các ứng dụng trên App Store của Onshop được viết và đóng gói thành các extension để cài đặt trên hệ thống sử dụng mã nguồn mở Opencart</p>
          <p>Ứng dụng sử dụng mô hình MVC với cấu trúc thư mục như sau: </p>
          <div class="feature-img">
            <img src="src/img/structure.jpg">
          </div>
          <p></p>
          <p>Cấu trúc đường dẫn đến thư mục "appstore" ở các luồng là cấu trúc mặc đinh.
            Nhà phát triển chỉ triển khai viết ứng dụng theo mô hình MVC bên trong các thư mục "appstore" này. </p>
          <h4>Admin</h4>
          <p>Source code nằm trong thư mục cha "admin" giúp quản lý hệ thống cài đặt, cấu hình các thông tin cần thiết cho ứng dụng.</p>
          <p>Nhà phát triển sẽ được cung cấp 1 số function giành cho các chứng năng mặc định cho ứng dụng như: </p>
          <p>- Cặt đặt ứng dụng</p>
          <p>- Gỡ ứng dụng</p>
          <p>- Cài đặt vị trí hiển thị của ứng dụng</p>
          <p>- Phương thức lấy dữ liệu của hệ thống</p>
          <h4>Catalog</h4>
          <p>Source code nằm trong thư mục cha "catalog" là phần sẽ thể hiện chức năng của ứng dụng đối với người dùng website .</p>
          <p>Mô hình MVC hoạt động riêng rẽ tương ứng với thành phần trong Admin và Catalog. </p>
        </div>
      </section>
      <section id="concept">
        <div class="section-title">
          <h2 class="mb-4">Các khái niệm, quy ước</h2>
        </div>
        <div class="section-content">
          <div class="content-group">
            <h4>App code</h4>
            <p>App code là tên mã của ứng dụng của bạn, thường được đặt theo tên viết tắt của ứng dụng. </p>
            <p>- Ví dụ: Tên ứng dụng là Flash Sale thì app code sẽ là flash_sale</p>
            <p>Mã app_code là định danh quan trọng, và là duy nhất để phân biệt các app khác nhau trên hệ thống App Store của Onshop.</p>
            <h4>Module</h4>
            <p>Ứng dụng của bạn, nếu muốn cung cấp chức năng và hiển thị để cho người dùng website thao tác thì cần tạo các thành phần (Module) cho ứng dụng
              và cấu hình vị trí hiển thị trên website.</p>
            <p>Onshop sẽ cung cấp các phương thức để nhà phát triển có thể :</p>
            <p> - Tạo module cho ứng dụng.</p>
            <p> - Xóa/ chỉnh sửa module.</p>
            <p> - Cấu hình vị trí hiển thị module trên website.</p>
          </div>
          <div class="content-group">
            <h4>Đường dẫn</h4>
            <p>Ứng dụng viết theo cấu trúc của Opencart nên cấu trúc đường dẫn sẽ là đường dẫn đến controller và function của nó.</p>
            <p>- Ví dụ: Bạn có function module trong controller flash_sale thì đường dẫn để gọi function này là: </p>
            <div class="group-code">
              <p>route=extension/appstore/flash_sale/module&user_token=EtLyM37n1QtE9TcuWif5EyHqdLqGvoHt</p>
            </div>
            <p>- user_token là param mặc định luôn phải có trong cấu trúc mỗi đường dẫn của ứng dụng</p>
            <p>Cách tạo 1 đường dẫn đầy đủ trong Opencart</p>
            <div class="group-code">
              <p>
                $url = $this->url->link('extension/appstore/flash_sale', 'user_token=' . $this->session->data['user_token'], true)
              </p>
            </div>
          </div>
          <div class="content-group">
            <h4>Model</h4>
            <p>Model thể hiện rõ các thao tác với cơ sở dữ liệu, để sử dụng được model các bạn sử dụng phương thức load như sau:</p>
            <div class="group-code">
              <p>// Load model</p>
              <p>$this->load->model('extension/appstore/flash_sale');</p>
              <p>// Call function in Model</p>
              <p>$this->model_extension_appstore_flash_sale->createTables();</p>
            </div>
            <p>Lưu ý: </p>
            <p> - Bạn chỉ được phép load các model do chính bạn tạo ra hoặc liên quan đến cài đặt ứng dụng được liệt kê và cung cấp.</p>
            <p> - Tất cả dữ liệu khác sẽ được cung cấp bằng các thư viện sẽ được mô tả sau.</p>

          </div>
          <div class="content-group">
            <h4>View</h4>
            <p>Cũng giống như các mô hình MCV, đây là phần giao diện (theme) dành cho người sử dụng.</p>
            <p>Để truyền dữ liệu từ controller ra view hãy sử dụng phương thức sau</p>
            <div class="group-code">
              <p>$this->response->setOutput($this->load->view('extension/appstore/flash_sale/edit_module',$data));</p>
            </div>
          </div>
          <div class="content-group">
            <h4>Layout</h4>
            <p>Là các thành phần được viết sẵn để bạn import vào giao diện của mình</p>
            <p>Các layout mặc định và bắt buộc bao gồm: custom_header, footer, custom_column_left</p>
            <p>Cách dùng:</p>
            <div class="group-code">
              <p>// Load các layout</p>
              <p>$data['custom_header'] = $this->load->controller('common/custom_header');</p>
              <p>$data['custom_column_left'] = $this->load->controller('common/custom_column_left');</p>
              <p>$data['footer'] = $this->load->controller('common/footer');</p>
              <p>// Truyền các layout ra view qua biến $data</p>
              <p>$this->response->setOutput($this->load->view('extension/appstore/flash_sale/edit_module',$data));</p>
            </div>
          </div>
        </div>
      </section>
      <section id="introduce3">
        <div class="section-title">
          <h2 class="mb-4">Chi tiết</h2>
        </div>
        <div class="section-content">
          <div class="content-group">
            <h4>Cài đặt ứng dụng</h4>
            <p> - Tất cả các ứng dụng để được cài đặt lên Appstore của Onshop thì tại file controller trong Admin: admin\controller\extension\appstore\{your_app_code.php} đều phải có hàm install</p>
            <p> - Hàm install này nhà phát triển có thể khai báo để tiến hành khởi tạo các bảng dữ liệu cần thiết cho ứng dụng của bạn. Đồng thời khai báo setting với Appstore bằng model sau. </p>
            <div class="group-code">
              <p>// Khởi tạo bảng dữ liệu</p>
              <p>$this->load->model('extension/appstore/flash_sale');</p>
              <p>$this->model_extension_appstore_flash_sale->createTables();</p>
              <p>// Khai báo setting</p>
              <p>
                $this->load->model('setting/setting');
              </p>
              <p>
                $this->model_setting_setting->editSetting('app_flash_sale', ['app_flash_sale_status' => 1]);
              </p>
            </div>
            <p>- Trong đó: flash_sale là app_code của ứng dụng</p>
          </div>
          <div class="content-group">
            <h4>Gỡ ứng dụng</h4>
            <p> - Tương tự như hàm install thì ứng dụng của bạn cũng bắt buộc cần có hàm uninstall để xóa các bảng liên quan và các cài đặt của ứng dụng .</p>
            <div class="group-code">
              <p>// Xóa đăng ký ứng dụng</p>
              <p>/* DROP các bảng đã thêm */</p>
              <p>$this->load->model('extension/appstore/flash_sale');</p>
              <p>$this->model_extension_appstore_flash_sale->dropTables();</p>
              <p>
                // Xóa cài đặt ứng dụng
              </p>
              <p>
                $this->load->model('setting/setting');
              </p>
              <p>$this->model_setting_setting->deleteSetting('app_flash_sale');</p>
            </div>
          </div>
          <div class="content-group">
            <p>Ở trên sử dụng các hàm dropTable() và createTables() thuộc model flash_sale, hãy định nghĩa 2 hàm này trong model của bạn tại: admin\model\extension\appstore\flash_sale</p>
            <div class="feature-img">
              <img src="src/img/model.jpg">
            </div>
          </div>
          <div class="content-group">
            <h4>Thêm modules cho ứng dụng</h4>
            <p>Ứng dụng của bạn cần hiển thị các thông tin và vị trí hiển thị ra ngoài website cho người dùng. Vậy hãy thêm các modules phù hợp cho ứng dụng</p>
            <p>- Một module được thêm cần có 2 trường mặc định là name và status ( 0/1 ). </p>
            <p>- Ví dụ: Ứng dụng khuyến mãi cần tạo 1 module với tên chương trình, thời gian khuyến mãi, ...vv</p>
            <p>Để thêm ứng dụng, sử dụng model "appstore_setting" như sau: </p>
            <div class="group-code">
              <p>// Load model</p>
              <p>$this->load->model('setting/appstore_setting');</p>
              <p>/* Add module</p>
              <p>Biến đầu tiên là app_code, biến thứ 2 là dữ liệu từ form mà bạn muốn nhập vào thông tin module của mình như: </p>
              <p> Tên module, status, ngày hết hạn,vv.. */</p>
              <p>$this->model_setting_appstore_setting->addModule('your_app_code', $this->request->post);</p>
            </div>
          </div>
          <div class="content-group">
            <h4>Chỉnh sửa modules cho ứng dụng</h4>
            <p>Trước hết hãy lấy các thông tin về module với module_id của module cần chỉnh sửa</p>
            <div class="group-code">
              <p>// Load model</p>
              <p>$this->load->model('setting/appstore_setting');</p>
              <p>// Info module</p>
              <p>// $this->request->get['module_id']: lấy module_id của module cần chỉnh sửa</p>
              <p>$module_info = $this->model_setting_appstore_setting->getModule($this->request->get['module_id']);</p>
              <p>$data['name'] = $module_info['name'];</p>
              <p>$data['status'] = $module_info['status'];</p>
            </div>
          </div>
          <div class="content-group">
            <h4>Xóa module</h4>
            <p>Để xóa 1 module, sử dụng hàm deleteModule trong model: model_setting_appstore_setting</p>
            <div class="group-code">
              <p>// Load model</p>
              <p>$this->load->model('setting/appstore_setting');</p>
              <p>// Delete module</p>
              <p>$this->model_setting_appstore_setting->deleteModule($this->request->get['module_id']);</p>
            </div>
          </div>
          <div class="content-group">
            <h4>Cài đặt vị trí hiển thị</h4>
            <p>Tại trang chỉnh sửa module hãy import layout chỉnh sửa vị trí hiển thị module mà Onshop đã cung cấp sẵn.</p>
            <div class="group-code">
              <p>// import layout config app</p>
              <p>$data['app_config'] = $this->load->controller('common/app_config/setTheme',$config);</p>
            </div>
            <div class="feature-img">
              <img src="src/img/app_config.jpg">
            </div>
            <p>Khi đó trang chỉnh sửa của bạn sẽ có 2 phần: </p>
            <p> - Phần 1: Để chỉnh sửa thông tin module.</p>
            <p> - Phần 2: Để người dùng cài đặt vị trí hiển thị module trên trang mong muốn.</p>
          </div>
          <div class="content-group">
            <h4>Lấy danh sách modules của ứng dụng</h4>
            <p>Để lấy danh sách modules chúng ta dựa vào "app_code" như sau: </p>
            <div class="group-code">
              <p>// Load model</p>
              <p>$this->load->model('setting/appstore_setting');</p>
              <p>// Lấy danh sách modules</p>
              <p>$modules = $this->model_setting_appstore_setting->getModulesByCode('your_app_code');</p>
            </div>
            <p>Thông tin của mỗi module đều được lưu vào biến setting dưới dạng json. Để xuất ra thông tin làm như sau: </p>
            <div class="group-code">
              <p>$setting_info = json_decode($module['setting'], true);</p>
              <p>$name_module = $setting_info['name'];</p>
              <p>$status = $setting_info['status'];</p>
            </div>
          </div>
        </div>
      </section>
      <section id="introduce4">
        <div class="section-title">
          <h2 class="mb-4">Giới thiệu</h2>
        </div>
        <div class="section-content">
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        </div>
      </section>
      <section id="introduce5">
        <div class="section-title">
          <h2 class="mb-4">Giới thiệu</h2>
        </div>
        <div class="section-content">
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        </div>
      </section>
    </div>
  </div>
  </body>
  <script type="text/javascript" src="src/js/jquery.min.js"></script>
  <script type="text/javascript" src="src/bootstrap/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="src/js/main.js"></script>
</html>
